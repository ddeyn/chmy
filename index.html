import React, { useState } from 'react';
import { 
  BookOpen, 
  Calculator, 
  Atom, 
  Beaker, 
  Scale, 
  Activity, 
  ArrowRight, 
  Lightbulb, 
  CheckCircle, 
  HelpCircle,
  Eye,
  EyeOff,
  Heart,
  Network, // Added for the new tab
  ArrowDown,
  ArrowUp
} from 'lucide-react';

const ChemistrySolverApp = () => {
  const [activeTab, setActiveTab] = useState('examples');
  const [expandedTopic, setExpandedTopic] = useState('all');
  const [revealedAnswers, setRevealedAnswers] = useState({});

  // State for the "Pathfinder" tool
  const [startPoint, setStartPoint] = useState('');
  const [endPoint, setEndPoint] = useState('');

  const toggleReveal = (id) => {
    setRevealedAnswers(prev => ({
      ...prev,
      [id]: !prev[id]
    }));
  };

  // --- Data & Logic for Pathfinder ---
  const paths = {
    mass: { name: 'ุงููุชูุฉ (Mass)', steps: { 
      moles: ['ุงูุณู ุนูู ุงููุฒู ุงูุฌุฒูุฆู (MW)'],
      molecules: ['ุงูุณู ุนูู ุงููุฒู ุงูุฌุฒูุฆู (MW) ููุญุตูู ุนูู ุงููููุงุช', 'ุงุถุฑุจ ูู ุนุฏุฏ ุฃููุฌุงุฏุฑู'],
      molarity: ['ุงูุณู ุนูู ุงููุฒู ุงูุฌุฒูุฆู (MW) ููุญุตูู ุนูู ุงููููุงุช', 'ุงูุณู ุนูู ุญุฌู ุงููุญููู ุจุงููุชุฑ'],
      normality: ['ุงูุณู ุนูู ุงููุฒู ุงูุฌุฒูุฆู (MW) ููุญุตูู ุนูู ุงููููุงุช', 'ุงูุณู ุนูู ุญุฌู ุงููุญููู ุจุงููุชุฑ ููุญุตูู ุนูู ุงููููุงุฑูุฉ', 'ุงุถุฑุจ ูู ุงูุชูุงูุค (z)']
    }},
    moles: { name: 'ุนุฏุฏ ุงููููุงุช (Moles)', steps: {
      mass: ['ุงุถุฑุจ ูู ุงููุฒู ุงูุฌุฒูุฆู (MW)'],
      molecules: ['ุงุถุฑุจ ูู ุนุฏุฏ ุฃููุฌุงุฏุฑู'],
      molarity: ['ุงูุณู ุนูู ุญุฌู ุงููุญููู ุจุงููุชุฑ'],
      normality: ['ุงูุณู ุนูู ุญุฌู ุงููุญููู ุจุงููุชุฑ', 'ุงุถุฑุจ ูู ุงูุชูุงูุค (z)']
    }},
    molarity: { name: 'ุงููููุงุฑูุฉ (M)', steps: {
      moles: ['ุงุถุฑุจ ูู ุญุฌู ุงููุญููู ุจุงููุชุฑ'],
      mass: ['ุงุถุฑุจ ูู ุญุฌู ุงููุญููู ุจุงููุชุฑ ููุญุตูู ุนูู ุงููููุงุช', 'ุงุถุฑุจ ูู ุงููุฒู ุงูุฌุฒูุฆู (MW)'],
      normality: ['ุงุถุฑุจ ูู ุงูุชูุงูุค (z)']
    }},
    normality: { name: 'ุงูุนูุงุฑูุฉ (N)', steps: {
      molarity: ['ุงูุณู ุนูู ุงูุชูุงูุค (z)'],
      moles: ['ุงูุณู ุนูู ุงูุชูุงูุค (z) ููุญุตูู ุนูู ุงููููุงุฑูุฉ', 'ุงุถุฑุจ ูู ุญุฌู ุงููุญููู ุจุงููุชุฑ']
    }}
  };

  const getPath = () => {
    if (!startPoint || !endPoint || startPoint === endPoint) return null;
    const pathData = paths[startPoint]?.steps[endPoint];
    return pathData || ['ูุง ููุฌุฏ ุทุฑูู ูุจุงุดุฑ ูุณุฌูุ ุญุงูู ุงููุฑูุฑ ุจุงููููุงุช ุฃููุงู.'];
  };

  // Topics for Examples
  const topics = [
    { id: 'quantum', title: 'ููููุงุก ุงููู ูุงูุถูุก', icon: <Activity className="w-5 h-5" /> },
    { id: 'moles', title: 'ุงููููุงุช ูุงููุฒู ุงูุฌุฒูุฆู', icon: <Scale className="w-5 h-5" /> },
    { id: 'conc', title: 'ุงูุชุฑููุฒ ูุงูุชุญุถูุฑ', icon: <Beaker className="w-5 h-5" /> },
    { id: 'volumetric', title: 'ุงูุชุญููู ุงูุญุฌูู', icon: <Calculator className="w-5 h-5" /> },
    { id: 'equilibrium', title: 'ุงูุงุชุฒุงู ูุงูู pH', icon: <ArrowRight className="w-5 h-5" /> },
  ];

  // Questions Data
  const questions = [
    // Quantum
    {
      id: 71,
      topic: 'quantum',
      title: 'ุณุคุงู 71 (ูููุฐุฌ A)',
      question: 'ุถูุก ุฃุฒุฑู ุทูู ููุฌุชู 434 nmุ ูุฅู ุชุฑุฏุฏ ุงูููุฌุฉ ูุณุงูู...',
      solution: [
        'ุงููุนุทูุงุช: ุงูุทูู ุงูููุฌู (ฮป) = 434 ร 10โปโน mุ ุณุฑุนุฉ ุงูุถูุก (c) = 3 ร 10โธ m/s',
        'ุงููุงููู: ฮฝ = c / ฮป',
        'ุงูุชุนููุถ: ฮฝ = (3 ร 10โธ) / (434 ร 10โปโน)',
        'ุงููุงุชุฌ: 6.9 ร 10ยนโด Hz'
      ],
      answer: '(B) 6.9 ร 10ยนโด'
    },
    {
      id: 74,
      topic: 'quantum',
      title: 'ุณุคุงู 74 (ูููุฐุฌ A)',
      question: 'ุงูุชุฑุฏุฏ ููููุชูู ุงูููุจุนุซ ูุฅููุชุฑูู ุฐุฑุฉ ุงูููุฏุฑูุฌูู ูู ุงูุญุงูุฉ n=2 ุฅูู ุงูุญุงูุฉ n=1 ูุณุงูู...',
      solution: [
        'ุงููุงููู: ูุนุงุฏูุฉ ุฑูุฏุจูุฑุฌ ฮฝ = R_H (1/nโยฒ - 1/nโยฒ)',
        'ุญูุซ R_H โ 3.29 ร 10ยนโต Hz',
        'ุงูุชุนููุถ: ฮฝ = 3.29 ร 10ยนโต (1/1ยฒ - 1/2ยฒ) = 3.29 ร 10ยนโต (0.75)',
        'ุงููุงุชุฌ: 2.47 ร 10ยนโต Hz'
      ],
      answer: '(A) 2.47 ร 10ยนโต'
    },
    {
      id: 85,
      topic: 'quantum',
      title: 'ุณุคุงู 85 (ูููุฐุฌ 3)',
      question: 'ุชุฑุฏุฏ ุฅุดุนุงุน ุทูู ููุฌุชู 600 ุณู ุนููุงู ุจุฃู ุณุฑุนุฉ ุงูุถูุก 3 ร 10ยนโฐ ุณู/ุซ ูู:',
      solution: [
        'ุงููุงููู: ฮฝ = c / ฮป',
        'ุงูุชุนููุถ: ฮฝ = (3 ร 10ยนโฐ) / 600',
        'ุงููุงุชุฌ: 5 ร 10โท Hz'
      ],
      answer: '(B) 5 ร 10โท ูุฑุชุฒ'
    },
    // Moles
    {
      id: 81,
      topic: 'moles',
      title: 'ุณุคุงู 81 (ูููุฐุฌ A)',
      question: 'ุนุฏุฏ ุงูุฌุฒูุฆุงุช ุงูููุฌูุฏุฉ ูู 25 ุฌุฑุงู H ูู:',
      solution: [
        'ุงุนุชุจุงุฑ ุงูุบุงุฒ Hโ (ูุฒู ุฌุฒูุฆู 2)',
        'ุนุฏุฏ ุงููููุงุช = ุงููุฒู / ุงููุฒู ุงูุฌุฒูุฆู = 25 / 2 = 12.5 ููู',
        'ุนุฏุฏ ุงูุฌุฒูุฆุงุช = ุนุฏุฏ ุงููููุงุช ร ุนุฏุฏ ุฃููุฌุงุฏุฑู',
        'ุงููุงุชุฌ: 12.5 ร 6.02 ร 10ยฒยณ = 75.25 ร 10ยฒยณ'
      ],
      answer: '(C) 75.25 ร 10ยฒยณ'
    },
    {
      id: 82,
      topic: 'moles',
      title: 'ุณุคุงู 82 (ูููุฐุฌ A)',
      question: 'ุนุฏุฏ ุงูุฃูุฒุงู ุงูููุฑูุงููุฉ ุงูููุฌูุฏุฉ ูู 27.3 ุฌุฑุงู ูู MnOโ ูุฒูู ุงูููุฑูุงูู 119:',
      solution: [
        'ุนุฏุฏ ุงูุฃูุฒุงู ุงูููุฑูุงููุฉ (ุงููููุงุช) = ุงููุฒู ุจุงูุฌุฑุงู / ุงููุฒู ุงูููุฑูุงูู',
        'ุงูุชุนููุถ: 27.3 / 119 โ 0.229',
        'ุงูุชูุฑูุจ ูุฃูุฑุจ ุฑูู ุตุญูุญ ูู ุงูุฎูุงุฑุงุช'
      ],
      answer: '(A) 0.2'
    },
    {
      id: 83,
      topic: 'moles',
      title: 'ุณุคุงู 83 (ูููุฐุฌ A)',
      question: 'ุนุฏุฏ ุงููููุงุช ุงูููุฌูุฏุฉ ูู 90 ุฌุฑุงู ูู HโO:',
      solution: [
        'ุงููุฒู ุงูุฌุฒูุฆู ูููุงุก = 18',
        'ุนุฏุฏ ุงููููุงุช = 90 / 18 = 5'
      ],
      answer: '(D) 5'
    },
    // Concentration
    {
      id: '85_conc',
      topic: 'conc',
      title: 'ุณุคุงู 85 (ูููุฐุฌ A)',
      question: 'ุงููุฒู ุงููุฐุงุจ ุงููุงุฒู ูุชุญุถูุฑ ูุชุฑ ูู MgClโ (ูุฒูู 95) ุจุชุฑููุฒ 0.01 ูููุฑ:',
      solution: [
        'ุงููุฒู = ุงููููุงุฑูุฉ ร ุงูุญุฌู (ูุชุฑ) ร ุงููุฒู ุงูุฌุฒูุฆู',
        'ุงูุชุนููุถ: 0.01 ร 1 ร 95 = 0.95 ุฌู'
      ],
      answer: '(B) 0.95 ุฌุฑุงู'
    },
    {
      id: 88,
      topic: 'conc',
      title: 'ุณุคุงู 88 (ูููุฐุฌ A)',
      question: 'ุงูุชุฑููุฒ ุงูููุฑูุงูู ููุญููู 27% (ูุฒููุฉ) ูู ุงููุดุงุฏุฑ NHโ (ูุฒู 17) ููุซุงูุชู 0.9:',
      solution: [
        'ุงููุงููู: M = (% ร d ร 1000) / MW',
        'ุงูุชุนููุถ: (0.27 ร 0.9 ร 1000) / 17',
        'ุงููุงุชุฌ: 243 / 17 โ 14.29'
      ],
      answer: '(B) 14.29'
    },
    {
      id: 89,
      topic: 'conc',
      title: 'ุณุคุงู 89 (ูููุฐุฌ A)',
      question: 'ูุชุญุถูุฑ 20 ูุชุฑ ูู ูุญููู NaโSOโ ุจุชุฑููุฒ 0.10 ูููุฑ ูู ูุญููู ูููุณ ุงูููุญ ุจุชุฑููุฒ 2.4 ูููุฑ ููุฒู:',
      solution: [
        'ูุงููู ุงูุชุฎููู: CโVโ = CโVโ',
        'ุงูุชุนููุถ: 2.4 ร Vโ = 0.10 ร 20',
        'Vโ = 2 / 2.4 = 0.833 ูุชุฑ'
      ],
      answer: '(C) 0.83 ูุชุฑ'
    },
    {
      id: 91,
      topic: 'conc',
      title: 'ุณุคุงู 91 (ูููุฐุฌ A)',
      question: 'ุงููุฒู ุงููุฐุงุจ ุจุงูุฌุฑุงู ุงููุงุฒู ูุชุญุถูุฑ 200 ูู ูู ูุญููู ุฌููููุฒ 10% (ูุฒููุฉ-ุญุฌููุฉ):',
      solution: [
        'ุงููุงููู: % (w/v) = (ุงููุฒู / ุงูุญุฌู) ร 100',
        'ุงูุชุนููุถ: 10 = (W / 200) ร 100',
        'W = (10 ร 200) / 100 = 20 ุฌู'
      ],
      answer: '(B) 20'
    },
    // Volumetric
    {
      id: 84,
      topic: 'volumetric',
      title: 'ุณุคุงู 84 (ูููุฐุฌ A)',
      question: 'ุนุฏุฏ ุงูููุงูุฆุงุช ุงูููุฌูุฏุฉ ูู 36.5 ุฌุฑุงู ูู HCl:',
      solution: [
        'ุงููุฒู ุงูููุงูุฆ ูู HCl = 36.5 / 1 = 36.5',
        'ุนุฏุฏ ุงูููุงูุฆุงุช = ุงููุฒู / ุงููุฒู ุงูููุงูุฆ = 36.5 / 36.5 = 1'
      ],
      answer: '(A) 1'
    },
    {
      id: 96,
      topic: 'volumetric',
      title: 'ุณุคุงู 96 (ูููุฐุฌ A)',
      question: 'ุนุฏุฏ ุงูููููููุงูุฆุงุช ูู 20 ูู ูู Ba(OH)โ 0.1 ุนูุงุฑู:',
      solution: [
        'ุงููุงููู: meq = N ร V(ml)',
        'ุงูุชุนููุถ: 0.1 ร 20 = 2'
      ],
      answer: '(B) 2'
    },
    {
      id: '94_tit',
      topic: 'volumetric',
      title: 'ุณุคุงู 94 (ูุนุงูุฑุฉ)',
      question: '30 ูู AgNOโ (0.05 N) ุชุนุงูุฑ 10 ูู ูููุฑูุฏ. ุงูุชุฑููุฒ ุงูุนูุงุฑู ูููููุฑูุฏ:',
      solution: [
        'ุงููุงููู: NโVโ = NโVโ',
        'ุงูุชุนููุถ: 0.05 ร 30 = N ร 10',
        '1.5 = 10N โ N = 0.15'
      ],
      answer: '(A) 0.15 ุนูุงุฑู'
    },
    // Equilibrium
    {
      id: 97,
      topic: 'equilibrium',
      title: 'ุณุคุงู 97 (ูููุฐุฌ ุตูุญุฉ 8)',
      question: 'ุญูุถ ุฎููู 0.1 ูููุฑุ [HโOโบ] = 1.32 ร 10โปยณ. ุงุญุณุจ Ka:',
      solution: [
        'ุงููุงููู: Ka โ [Hโบ]ยฒ / C',
        'ุงูุชุนููุถ: (1.32 ร 10โปยณ)ยฒ / 0.1',
        'ุงููุงุชุฌ: 1.74 ร 10โปโต'
      ],
      answer: '(A) 1.74 ร 10โปโต'
    },
    {
      id: 98,
      topic: 'equilibrium',
      title: 'ุณุคุงู 98 (ุญุงุตู ุงูุฅุฐุงุจุฉ)',
      question: 'ุญุงุตู ุงูุฅุฐุงุจุฉ Ksp ูู Mg(OH)โุ ุฅุฐุง ูุงู ุชุฑููุฒ ุงููุบูุณููู 3.7 ร 10โปโด:',
      solution: [
        'ูุนุงุฏูุฉ ุงูุชููู: Mg(OH)โ โ Mgยฒโบ + 2OHโป',
        'ุฅุฐุง ูุงู [Mg] = sุ ูุฅู [OH] = 2s',
        'Ksp = [Mg][OH]ยฒ = s(2s)ยฒ = 4sยณ',
        'ุงูุชุนููุถ: 4 ร (3.7 ร 10โปโด)ยณ โ 2.02 ร 10โปยนโฐ'
      ],
      answer: '2.02 ร 10โปยนโฐ'
    }
  ];

  // Formulas Data
  const formulaCategories = [
    {
      title: "ุฃุณุงุณูุงุช ููุณูุฉ (Basics)",
      description: "ููุงููู ุจุฏูููุฉ ููู ูููุฉ ุฌุฏุงู",
      items: [
        { eng: "Density (d) = Mass (m) / Volume (V)", ar: "ุงููุซุงูุฉ = ุงููุชูุฉ / ุงูุญุฌู", note: "ูุญุฏุงุช ุดุงุฆุนุฉ: g/ml ุฃู g/cmยณ" },
        { eng: "1 Liter (L) = 1000 milliliters (ml)", ar: "ุงูุชุญููู ูู ูุชุฑ ุฅูู ูููููุชุฑ", note: "ููุชุญููู ูู ูู ุฅูู ูุชุฑ ููุณู ุนูู 1000" },
        { eng: "1 kg = 1000 g, 1 g = 1000 mg", ar: "ุชุญูููุงุช ุงููุฒู", note: "ููุชุญููู ูู ููููุฌุฑุงู ุฅูู ุฌุฑุงู ููุณู ุนูู 1000" },
        { eng: "Percentage % = (Part / Total) ร 100", ar: "ุงููุณุจุฉ ุงููุฆููุฉ = (ุงูุฌุฒุก / ุงููู) ร 100", note: "ุชุณุชุฎุฏู ูู ุงููุณุจ ุงููุฒููุฉ ูุงูุญุฌููุฉ" }
      ]
    },
    {
      title: "ููุงููู ุงูุถูุก ูุงููู (Light & Quantum)",
      description: "ุญุณุงุจุงุช ุงูุชุฑุฏุฏ ูุงูุทูู ุงูููุฌู ูุงูุทุงูุฉ",
      items: [
        { eng: "ฮฝ = c / ฮป", ar: "ุงูุชุฑุฏุฏ = ุณุฑุนุฉ ุงูุถูุก / ุงูุทูู ุงูููุฌู", note: "ุณุฑุนุฉ ุงูุถูุก c ุซุงุจุช = 3ร10โธ ู/ุซ" },
        { eng: "E = h ร ฮฝ", ar: "ุทุงูุฉ ุงูููุชูู = ุซุงุจุช ุจูุงูู ร ุงูุชุฑุฏุฏ", note: "" },
        { eng: "ฮฝ = R_H (1/nโยฒ - 1/nโยฒ)", ar: "ูุนุงุฏูุฉ ุฑูุฏุจูุฑุฌ (ูุญุณุงุจ ุชุฑุฏุฏ ุทูู ุงูููุฏุฑูุฌูู)", note: "nโ ุงููุณุชูู ุงูุฃูู ุทุงูุฉุ nโ ุงููุณุชูู ุงูุฃุนูู" }
      ]
    },
    {
      title: "ุงูุญุณุงุจ ุงูููููุงุฆู ูุงููููุงุช (Stoichiometry)",
      description: "ุญุฌุฑ ุงูุฃุณุงุณ ูู ุงูููููุงุก ุงูุชุญููููุฉ",
      items: [
        { eng: "Moles (n) = Mass (g) / Molecular Weight (MW)", ar: "ุนุฏุฏ ุงููููุงุช = ุงููุฒู ุจุงูุฌุฑุงู / ุงููุฒู ุงูุฌุฒูุฆู", note: "ุฃูู ูุงููู ูู ุงูููููุงุก" },
        { eng: "No. of Molecules = Moles ร Avogadro's No.", ar: "ุนุฏุฏ ุงูุฌุฒูุฆุงุช = ุนุฏุฏ ุงููููุงุช ร ุนุฏุฏ ุฃููุฌุงุฏุฑู", note: "ุนุฏุฏ ุฃููุฌุงุฏุฑู โ 6.02 ร 10ยฒยณ" }
      ]
    },
    {
      title: "ููุงููู ุงูุชุฑููุฒ (Concentration)",
      description: "ุงููููุงุฑูุฉุ ุงูุนูุงุฑูุฉุ ูุงูุชุฎููู",
      items: [
        { eng: "Molarity (M) = Moles / Volume (L)", ar: "ุงููููุงุฑูุฉ = ุนุฏุฏ ุงููููุงุช / ุงูุญุฌู ุจุงููุชุฑ", note: "ูุญุฏุชูุง: mol/L ุฃู M" },
        { eng: "Normality (N) = M ร z", ar: "ุงูุนูุงุฑูุฉ = ุงููููุงุฑูุฉ ร ุงูุชูุงูุค", note: "z ูู ุงูุชูุงูุค (ุนุฏุฏ H ููุญูุถุ OH ูููุงุนุฏุฉุ ุฃู ุงูุฅููุชุฑููุงุช ููุฃูุณุฏุฉ)" },
        { eng: "ppm โ mg / L", ar: "ุฌุฒุก ูู ุงูููููู = ููููุฌุฑุงู ููู ูุชุฑ", note: "ุชุณุชุฎุฏู ูููุญุงููู ุงููุฎููุฉ ุฌุฏุงู" },
        { eng: "Cโ ร Vโ = Cโ ร Vโ", ar: "ูุงููู ุงูุชุฎููู: ุชุฑููุฒรุญุฌู (ูุจู) = ุชุฑููุฒรุญุฌู (ุจุนุฏ)", note: "ูุฌุจ ุฃู ุชููู ูุญุฏุงุช ุงูุญุฌู ููุญุฏุฉ ูู ุงูุทุฑููู" },
        { eng: "% (w/v) = (Mass of solute (g) / Volume of solution (ml)) ร 100", ar: "ุงููุณุจุฉ ุงููุฒููุฉ ุงูุญุฌููุฉ", note: "ุงูุชุจู: ุงููุฒู ุจุงูุฌุฑุงู ูุงูุญุฌู ุจุงููููููุชุฑ" }
      ]
    },
    {
      title: "ุงููุฒู ุงูููุงูุฆ (Equivalent Weight)",
      description: "ููู ุฌุฏุงู ูููุนุงูุฑุฉ",
      items: [
        { eng: "Eq. Wt = Molecular Weight / z", ar: "ุงููุฒู ุงูููุงูุฆ = ุงููุฒู ุงูุฌุฒูุฆู / ุงูุชูุงูุค", note: "z: ููุญูุถ (Hโบ)ุ ูููุงุนุฏุฉ (OHโป)ุ ููุฃููุงุญ (ุดุญูุฉ ุงููุงุชููู)" },
        { eng: "No. of Equivalents = Mass / Eq. Wt", ar: "ุนุฏุฏ ุงูููุงูุฆุงุช = ุงููุฒู / ุงููุฒู ุงูููุงูุฆ", note: "" }
      ]
    },
    {
      title: "ุงูุงุชุฒุงู ูุงูุฃุณ ุงูููุฏุฑูุฌููู (Equilibrium & pH)",
      description: "ุญุณุงุจุงุช ุงูุญููุถุฉ ูุงูุฐูุจุงููุฉ",
      items: [
        { eng: "pH = -log[Hโบ]", ar: "ุงูุฃุณ ุงูููุฏุฑูุฌููู = ุณุงูุจ ููุบุงุฑูุชู ุชุฑููุฒ ุงูููุฏุฑูุฌูู", note: "pH + pOH = 14" },
        { eng: "Ka = [Hโบ]ยฒ / C", ar: "ุซุงุจุช ุชุฃูู ุงูุญูุถ ุงูุถุนูู", note: "ุชุณุชุฎุฏู ูุญุณุงุจ [Hโบ] ููุฃุญูุงุถ ุงูุถุนููุฉ: โ(Ka ร C)" },
        { eng: "Ksp = 4sยณ", ar: "ุญุงุตู ุงูุฅุฐุงุจุฉ ูููุญ ุซูุงุซู ุงูุฃูููุงุช (ูุซู Mg(OH)โ)", note: "s ูู ุงูุฐูุจุงููุฉ ุงููููุงุฑูุฉ" },
        { eng: "I = 0.5 โ Ci Ziยฒ", ar: "ุงูููุฉ ุงูุฃููููุฉ = ูุตู ูุฌููุน (ุงูุชุฑููุฒ ร ูุฑุจุน ุงูุดุญูุฉ)", note: "Ci ุงูุชุฑููุฒุ Zi ุงูุดุญูุฉ" }
      ]
    }
  ];

  const filteredQuestions = expandedTopic === 'all' 
    ? questions 
    : questions.filter(q => q.topic === expandedTopic);

  return (
    <div className="min-h-screen bg-gray-50 text-gray-800 font-sans" dir="rtl">
      {/* Header */}
      <header className="bg-blue-900 text-white shadow-lg sticky top-0 z-50">
        <div className="container mx-auto px-4 py-4 flex flex-col md:flex-row justify-between items-center gap-4">
          <div className="flex flex-col items-start">
            <div className="flex items-center space-x-2 space-x-reverse">
              <Atom className="w-8 h-8 text-yellow-400" />
              <h1 className="text-2xl font-bold">ููุฑุงุฌุนุฉ ุงูููููุงุก ุงูุฌุงูุนูุฉ</h1>
            </div>
            <div className="mr-10 mt-1 flex flex-col">
              <span className="text-xs text-blue-200 opacity-90">
                ุชู ุงูุชุตููู ุจูุงุณุทุฉ ุงูุทุงูุจ ุนุจุฏุงูุฑุญูู ุงุญูุฏ ูุญูุฏ
              </span>
              <span className="text-[10px] text-yellow-300 flex items-center gap-1">
                <Heart className="w-3 h-3" />
                ุงู ุงุณุชูุฏุช ุงุฏุนููู ุฏุนูุฉ ุญููุฉ
              </span>
            </div>
          </div>
          
          <nav className="flex bg-blue-800 rounded-lg p-1 w-full md:w-auto overflow-x-auto">
            <button onClick={() => setActiveTab('examples')} className={`flex items-center justify-center flex-1 md:flex-none px-4 py-2 rounded-md transition-all whitespace-nowrap ${activeTab === 'examples' ? 'bg-white text-blue-900 shadow font-bold' : 'text-blue-200 hover:text-white'}`}>
              <BookOpen className="w-4 h-4 ml-2" />
              ุงููุณุงุฆู ุงููุญูููุฉ
            </button>
            <button onClick={() => setActiveTab('quiz')} className={`flex items-center justify-center flex-1 md:flex-none px-4 py-2 rounded-md transition-all whitespace-nowrap ${activeTab === 'quiz' ? 'bg-white text-blue-900 shadow font-bold' : 'text-blue-200 hover:text-white'}`}>
              <CheckCircle className="w-4 h-4 ml-2" />
              ุฌุฑุจ ุจููุณู
            </button>
            <button onClick={() => setActiveTab('formulas')} className={`flex items-center justify-center flex-1 md:flex-none px-4 py-2 rounded-md transition-all whitespace-nowrap ${activeTab === 'formulas' ? 'bg-white text-blue-900 shadow font-bold' : 'text-blue-200 hover:text-white'}`}>
              <Calculator className="w-4 h-4 ml-2" />
              ููุฎุต ุงูููุงููู
            </button>
            {/* NEW TAB BUTTON */}
            <button onClick={() => setActiveTab('map')} className={`flex items-center justify-center flex-1 md:flex-none px-4 py-2 rounded-md transition-all whitespace-nowrap ${activeTab === 'map' ? 'bg-white text-blue-900 shadow font-bold' : 'text-blue-200 hover:text-white'}`}>
              <Network className="w-4 h-4 ml-2" />
              ุฎุฑูุทุฉ ุงูููุงููู
            </button>
          </nav>
        </div>
      </header>

      <main className="container mx-auto px-4 py-8">
        
        {/* EXAMPLES SECTION */}
        {activeTab === 'examples' && (
          <div className="space-y-6 animate-fadeIn">
            <div className="bg-blue-50 border-r-4 border-blue-500 p-4 rounded shadow-sm mb-6">
               <p className="text-blue-800 font-medium">
                 ูู ูุฐุง ุงููุณูุ ููููู ุงุณุชุนุฑุงุถ ุงููุณุงุฆู ูุน ุงูุญููู ูุจุงุดุฑุฉ. ุงุฎุชุฑ ุงูููุถูุน ูุชุตููุฉ ุงูุฃุณุฆูุฉ.
               </p>
            </div>
            {/* Filters */}
            <div className="flex flex-wrap gap-2 justify-center mb-8">
              <button onClick={() => setExpandedTopic('all')} className={`px-4 py-2 rounded-full border transition-colors ${expandedTopic === 'all' ? 'bg-blue-600 text-white border-blue-600' : 'bg-white text-gray-600 border-gray-300 hover:bg-gray-50'}`}>ุงููู</button>
              {topics.map(topic => (
                <button key={topic.id} onClick={() => setExpandedTopic(topic.id)} className={`flex items-center px-4 py-2 rounded-full border transition-colors ${expandedTopic === topic.id ? 'bg-blue-600 text-white border-blue-600' : 'bg-white text-gray-600 border-gray-300 hover:bg-gray-50'}`}>
                  <span className="ml-2">{topic.icon}</span>{topic.title}
                </button>
              ))}
            </div>
            {/* Grid */}
            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
              {filteredQuestions.map((q) => (
                <div key={q.id} className="bg-white rounded-xl shadow-md border border-gray-100 overflow-hidden hover:shadow-lg transition-shadow">
                  <div className="bg-gray-50 px-6 py-4 border-b border-gray-100 flex justify-between items-center">
                    <span className="text-sm font-semibold text-blue-600 bg-blue-50 px-3 py-1 rounded-full">{topics.find(t => t.id === q.topic)?.title}</span>
                    <span className="text-xs text-gray-400 font-mono">{q.title}</span>
                  </div>
                  <div className="p-6">
                    <h3 className="text-lg font-bold text-gray-800 mb-4 leading-relaxed">{q.question}</h3>
                    <div className="bg-yellow-50 p-4 rounded-lg border-r-4 border-yellow-400 mb-4">
                      <h4 className="font-bold text-yellow-800 mb-2 flex items-center"><Lightbulb className="w-4 h-4 ml-2" />ุฎุทูุงุช ุงูุญู:</h4>
                      <ul className="list-disc list-inside space-y-2 text-gray-700 text-sm">{q.solution.map((step, idx) => (<li key={idx} className="leading-relaxed">{step}</li>))}</ul>
                    </div>
                    <div className="flex justify-between items-center bg-green-50 px-4 py-3 rounded-lg border border-green-100">
                      <span className="text-green-800 font-semibold">ุงูุฅุฌุงุจุฉ ุงูููุงุฆูุฉ:</span>
                      <span className="text-green-900 font-bold font-mono text-lg">{q.answer}</span>
                    </div>
                  </div>
                </div>
              ))}
            </div>
          </div>
        )}

        {/* QUIZ SECTION */}
        {activeTab === 'quiz' && (
          <div className="max-w-3xl mx-auto space-y-8 animate-fadeIn">
            <div className="bg-purple-50 border border-purple-200 rounded-lg p-6 text-center">
              <h2 className="text-xl font-bold text-purple-900 mb-2 flex items-center justify-center"><HelpCircle className="w-6 h-6 ml-2" />ุงุฎุชุจุฑ ูุนูููุงุชู</h2>
              <p className="text-purple-700">ุญุงูู ุญู ุงููุณุฃูุฉ ุจููุณู ูู ูุฑูุฉ ุฎุงุฑุฌูุฉุ ุซู ุงุถุบุท ุนูู ุงูุฒุฑ ูุนุฑุถ ุงูุญู ุงูุชูุตููู ูููุงุฑูุฉ ุฅุฌุงุจุชู.</p>
            </div>
            <div className="space-y-6">
              {questions.map((q, index) => (
                <div key={q.id} className="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
                  <div className="p-6 border-b border-gray-50">
                    <div className="flex justify-between items-center mb-4">
                      <span className="inline-block bg-gray-100 text-gray-600 text-xs px-2 py-1 rounded">ูุณุฃูุฉ ุฑูู {index + 1}</span>
                      <span className="text-sm font-semibold text-blue-600">{topics.find(t => t.id === q.topic)?.title}</span>
                    </div>
                    <h3 className="text-xl font-bold text-gray-800 leading-relaxed mb-6">{q.question}</h3>
                    <button onClick={() => toggleReveal(q.id)} className={`w-full py-3 px-4 rounded-lg font-bold flex items-center justify-center transition-all ${revealedAnswers[q.id] ? 'bg-gray-100 text-gray-600 hover:bg-gray-200' : 'bg-blue-600 text-white hover:bg-blue-700 shadow-md hover:shadow-lg'}`}>
                      {revealedAnswers[q.id] ? (<><EyeOff className="w-5 h-5 ml-2" />ุฅุฎูุงุก ุงูุญู</>) : (<><Eye className="w-5 h-5 ml-2" />ุนุฑุถ ุงูุญู ูุงูุชูุณูุฑ</>)}
                    </button>
                  </div>
                  {revealedAnswers[q.id] && (
                    <div className="bg-blue-50 p-6 border-t-2 border-blue-200 animate-slideDown">
                      <div className="mb-6">
                        <h4 className="font-bold text-blue-900 mb-3 flex items-center"><CheckCircle className="w-5 h-5 ml-2 text-green-600" />ุงูุฅุฌุงุจุฉ ุงูุตุญูุญุฉ:</h4>
                        <div className="bg-white p-3 rounded border border-blue-100 font-mono text-lg font-bold text-green-700 text-center shadow-sm">{q.answer}</div>
                      </div>
                      <div className="bg-white p-4 rounded-lg border border-gray-200">
                        <h4 className="font-bold text-gray-700 mb-3 border-b pb-2">ุงูุชูุณูุฑ ูุงูุฎุทูุงุช:</h4>
                        <ul className="space-y-3">{q.solution.map((step, idx) => (<li key={idx} className="flex items-start text-gray-700"><span className="bg-blue-100 text-blue-600 rounded-full w-6 h-6 flex items-center justify-center text-xs font-bold ml-3 flex-shrink-0 mt-1">{idx + 1}</span><span className="leading-relaxed">{step}</span></li>))}</ul>
                      </div>
                    </div>
                  )}
                </div>
              ))}
            </div>
          </div>
        )}

        {/* FORMULAS SECTION */}
        {activeTab === 'formulas' && (
          <div className="max-w-4xl mx-auto space-y-8 animate-fadeIn">
            <div className="bg-blue-50 border border-blue-200 rounded-lg p-6 mb-8">
              <h2 className="text-xl font-bold text-blue-900 mb-2">ุฏููู ุงูููุงููู ุงูุดุงูู</h2>
              <p className="text-blue-700">ุชู ุชุฌููุน ุงูููุงููู ุงููุณุชุฎุฏูุฉ ูู ุงูุงูุชุญุงูุงุชุ ุจุงูุฅุถุงูุฉ ุฅูู ุงูููุงููู ุงูุฃุณุงุณูุฉ ุงูุชู ูุฏ ุชููู ูุณูุชูุง ูู ุงูุฏุฑุงุณุฉ ุงูุณุงุจูุฉ.</p>
            </div>
            <div className="grid gap-8">
              {formulaCategories.map((category, idx) => (
                <div key={idx} className="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
                  <div className="bg-gradient-to-l from-gray-50 to-white px-6 py-4 border-b border-gray-100">
                    <h3 className="text-xl font-bold text-gray-800">{category.title}</h3>
                    <p className="text-sm text-gray-500 mt-1">{category.description}</p>
                  </div>
                  <div className="divide-y divide-gray-100">
                    {category.items.map((item, itemIdx) => (
                      <div key={itemIdx} className="p-6 hover:bg-gray-50 transition-colors">
                        <div className="flex flex-col md:flex-row md:items-center justify-between gap-4">
                          <div className="flex-1">
                            <code className="block text-lg font-bold text-blue-700 bg-blue-50 p-3 rounded-lg mb-2 font-mono" dir="ltr">{item.eng}</code>
                            <div className="flex items-center text-gray-700 font-medium mr-1"><ArrowRight className="w-4 h-4 ml-2 text-gray-400" />{item.ar}</div>
                          </div>
                          {item.note && (<div className="md:w-1/3 text-sm text-gray-500 bg-gray-50 p-3 rounded border border-gray-100 italic">๐ก {item.note}</div>)}
                        </div>
                      </div>
                    ))}
                  </div>
                </div>
              ))}
            </div>
          </div>
        )}

        {/* NEW TAB: FORMULA MAP (Chemical Map) */}
        {activeTab === 'map' && (
          <div className="max-w-4xl mx-auto space-y-12 animate-fadeIn">
            
            {/* Visual Mole Map */}
            <div className="bg-white rounded-xl shadow-md border border-gray-200 p-8 text-center">
              <h2 className="text-2xl font-bold text-blue-900 mb-6 flex items-center justify-center">
                <Network className="w-6 h-6 ml-2" /> ุฎุฑูุทุฉ ูุญุทุฉ ุงููููุงุช (The Mole Map)
              </h2>
              <p className="text-gray-600 mb-8">ุงูููู ูู ููุจ ุงูููููุงุก. ูู ุงูุทุฑู ุชุคุฏู ุฅููู ูููู!</p>
              
              <div className="relative flex flex-col items-center justify-center space-y-8">
                {/* Row 1 */}
                <div className="flex justify-between w-full max-w-3xl">
                  {/* Mass */}
                  <div className="flex flex-col items-center">
                    <div className="bg-green-100 border-2 border-green-500 text-green-800 font-bold p-4 rounded-lg shadow w-32">ุงููุชูุฉ (g)</div>
                    <div className="h-8 w-0.5 bg-gray-300 my-1"></div>
                    <div className="text-xs text-gray-500 bg-white border px-2 py-1 rounded shadow-sm z-10">รท MW</div>
                    <ArrowDown className="text-gray-400" />
                  </div>
                  
                  {/* Molecules */}
                  <div className="flex flex-col items-center">
                     <div className="bg-purple-100 border-2 border-purple-500 text-purple-800 font-bold p-4 rounded-lg shadow w-36">ุงูุฌุฒูุฆุงุช/ุงูุฐุฑุงุช</div>
                     <div className="h-8 w-0.5 bg-gray-300 my-1"></div>
                     <div className="text-xs text-gray-500 bg-white border px-2 py-1 rounded shadow-sm z-10">รท Avogadro</div>
                     <ArrowDown className="text-gray-400" />
                  </div>
                </div>

                {/* Center: MOLES */}
                <div className="bg-blue-600 text-white font-extrabold text-xl p-6 rounded-full shadow-xl border-4 border-blue-200 w-40 h-40 flex flex-col items-center justify-center z-20">
                  <span>ุงููููุงุช</span>
                  <span className="text-sm font-normal text-blue-200 mt-1">(n)</span>
                </div>

                {/* Arrows connecting center to bottom */}
                <div className="flex justify-center w-full space-x-20 space-x-reverse">
                   <div className="flex flex-col items-center">
                     <ArrowDown className="text-gray-400" />
                     <div className="text-xs text-gray-500 bg-white border px-2 py-1 rounded shadow-sm z-10 my-1">รท ุงูุญุฌู (L)</div>
                     <div className="h-8 w-0.5 bg-gray-300"></div>
                   </div>
                </div>

                {/* Row 3 */}
                <div className="flex flex-col items-center">
                  <div className="bg-orange-100 border-2 border-orange-500 text-orange-800 font-bold p-4 rounded-lg shadow w-32">ุงููููุงุฑูุฉ (M)</div>
                  <div className="my-2 text-gray-400"><ArrowDown size={16} /> <span className="text-xs">ร ุงูุชูุงูุค (z)</span></div>
                  <div className="bg-red-100 border-2 border-red-500 text-red-800 font-bold p-4 rounded-lg shadow w-32">ุงูุนูุงุฑูุฉ (N)</div>
                </div>
              </div>
            </div>

            {/* Interactive Pathfinder */}
            <div className="bg-indigo-50 border border-indigo-200 rounded-xl p-8">
              <h2 className="text-2xl font-bold text-indigo-900 mb-4 flex items-center">
                <Lightbulb className="w-6 h-6 ml-2 text-yellow-500" />
                ุงูููุฑุดุฏ ุงูููููุงุฆู (Interactive Guide)
              </h2>
              <p className="text-indigo-700 mb-6">
                ุชุงุฆู ูู ุงููุณุฃูุฉุ ุงุฎุชุฑ "ุงููุนุทู" ู "ุงููุทููุจ" ูุณุฃุฑุณู ูู ุงูุทุฑูู.
              </p>

              <div className="flex flex-col md:flex-row gap-4 mb-6">
                <div className="flex-1">
                  <label className="block text-sm font-bold text-gray-700 mb-2">ุฃูุง ุฃููู (ุงููุนุทู):</label>
                  <select 
                    value={startPoint} 
                    onChange={(e) => setStartPoint(e.target.value)}
                    className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none"
                  >
                    <option value="">-- ุงุฎุชุฑ --</option>
                    {Object.entries(paths).map(([key, val]) => (
                      <option key={key} value={key}>{val.name}</option>
                    ))}
                  </select>
                </div>
                <div className="flex items-center justify-center text-indigo-300">
                  <ArrowRight className="w-8 h-8 hidden md:block" />
                  <ArrowDown className="w-8 h-8 md:hidden" />
                </div>
                <div className="flex-1">
                  <label className="block text-sm font-bold text-gray-700 mb-2">ุฃุฑูุฏ ุงููุตูู ุฅูู (ุงููุทููุจ):</label>
                  <select 
                    value={endPoint} 
                    onChange={(e) => setEndPoint(e.target.value)}
                    className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none"
                  >
                    <option value="">-- ุงุฎุชุฑ --</option>
                    {Object.entries(paths).map(([key, val]) => (
                      <option key={key} value={key}>{val.name}</option>
                    ))}
                  </select>
                </div>
              </div>

              {/* Result Area */}
              {startPoint && endPoint && startPoint !== endPoint && (
                <div className="bg-white rounded-lg p-6 shadow-sm border border-indigo-100 animate-fadeIn">
                   <h3 className="font-bold text-gray-800 mb-4 border-b pb-2">ุฎุทูุงุช ุงูุญู ุงูููุชุฑุญุฉ:</h3>
                   <div className="space-y-4">
                     {getPath().map((step, idx) => (
                       <div key={idx} className="flex items-center">
                         <span className="bg-indigo-600 text-white w-8 h-8 rounded-full flex items-center justify-center font-bold ml-4 flex-shrink-0">
                           {idx + 1}
                         </span>
                         <span className="text-lg text-gray-700">{step}</span>
                       </div>
                     ))}
                   </div>
                </div>
              )}
            </div>

            {/* Acid Base Circle */}
            <div className="bg-white rounded-xl shadow-md border border-gray-200 p-8">
               <h2 className="text-2xl font-bold text-pink-900 mb-6 text-center">
                ุนูุงูุงุช ุงูุฃุญูุงุถ ูุงูููุงุนุฏ (pH Circle)
              </h2>
              <div className="grid grid-cols-2 gap-8 max-w-lg mx-auto text-center relative">
                 {/* Box 1 */}
                 <div className="bg-pink-50 p-4 rounded-lg border border-pink-200">
                   <div className="font-bold text-xl text-pink-700">pH</div>
                 </div>
                 {/* Box 2 */}
                 <div className="bg-blue-50 p-4 rounded-lg border border-blue-200">
                   <div className="font-bold text-xl text-blue-700">pOH</div>
                 </div>
                 
                 {/* Connection Horizontal Top */}
                 <div className="absolute top-1/4 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-white px-2 text-xs text-gray-500 border rounded">
                   pH + pOH = 14
                 </div>

                 {/* Box 3 */}
                 <div className="bg-pink-50 p-4 rounded-lg border border-pink-200 mt-8">
                   <div className="font-bold text-xl text-pink-700">[H+]</div>
                 </div>
                 {/* Box 4 */}
                 <div className="bg-blue-50 p-4 rounded-lg border border-blue-200 mt-8">
                   <div className="font-bold text-xl text-blue-700">[OH-]</div>
                 </div>

                 {/* Vertical Connections */}
                 <div className="absolute left-1/4 top-1/2 transform -translate-x-1/2 text-xs text-gray-400 rotate-90">pH = -log[H+]</div>
                 <div className="absolute right-1/4 top-1/2 transform translate-x-1/2 text-xs text-gray-400 rotate-90">pOH = -log[OH-]</div>
              </div>
            </div>

          </div>
        )}
      </main>
      
      <footer className="bg-gray-800 text-gray-400 py-8 mt-12 text-center">
        <p>ุชู ุฅุนุฏุงุฏ ูุฐุง ุงููุญุชูู ุงูุชุนูููู ูููุฑุงุฌุนุฉ ุงูุฌุงูุนูุฉ</p>
        <p className="text-xs mt-2 text-gray-500">ุชู ุงูุชุตููู ุจูุงุณุทุฉ ุงูุทุงูุจ ุนุจุฏุงูุฑุญูู ุงุญูุฏ ูุญูุฏ</p>
      </footer>
    </div>
  );
};

export default ChemistrySolverApp;
